# SprintPilot Data Service API Tests

### Base URLs
# @baseUrl = http://localhost:8787
@baseUrl = https://project-copilot-data-service.tarundhillon14330.workers.dev

### Variables (update these after creating resources)
@projectId = cbdb4743-d375-4458-b7ef-0cb47bc02963
@docId = 70f0af15-d202-47dd-82b1-88bdb9b21a84
@issueId = 89ea82dc-46b2-4577-883d-38479dc03327

###############################################
# PROJECT ENDPOINTS
###############################################

### Create Project
# @name createProject
POST {{baseUrl}}/api/projects
Content-Type: application/json

{
  "name": "My First Project",
  "description": "Testing Phase 2 CRUD API"
}

### Get Project by ID
GET {{baseUrl}}/api/projects/{{projectId}}

### List All Projects
GET {{baseUrl}}/api/projects

###############################################
# DOC ENDPOINTS
###############################################

### Create Doc (File Upload - Markdown)
# @name createDocFile
POST {{baseUrl}}/api/projects/{{projectId}}/docs
Content-Type: multipart/form-data; boundary=----FormBoundary7MA4YWxkTrZu0gW

------FormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="comprehensive-ai-guide.md"
Content-Type: text/markdown

< ../../../test-docs/comprehensive-ai-guide.md
------FormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="docType"

design
------FormBoundary7MA4YWxkTrZu0gW--

### Create Doc (File Upload - Text)
POST {{baseUrl}}/api/projects/{{projectId}}/docs
Content-Type: multipart/form-data; boundary=----FormBoundary7MA4YWxkTrZu0gW

------FormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="notes.txt"
Content-Type: text/plain

< ../../../test-docs/notes.txt
------FormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="title"

Project Meeting Notes
------FormBoundary7MA4YWxkTrZu0gW--

### Create Doc (File Upload - JSON)
POST {{baseUrl}}/api/projects/{{projectId}}/docs
Content-Type: multipart/form-data; boundary=----FormBoundary7MA4YWxkTrZu0gW

------FormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="config.json"
Content-Type: application/json

< ../../../test-docs/config.json
------FormBoundary7MA4YWxkTrZu0gW--

### Create Doc (Legacy - JSON)
# @name createDoc
POST {{baseUrl}}/api/projects/{{projectId}}/docs
Content-Type: application/json

{
  "title": "System Architecture",
  "docType": "design",
  "content": "This tarun test test document describes the overall system architecture. We use Cloudflare Workers for the backend API, R2 for storage, and Postgres with pgvector for the database."
}

### Get Doc by ID (with content)
GET {{baseUrl}}/api/projects/{{projectId}}/docs/{{docId}}

### List All Docs in Project
GET {{baseUrl}}/api/projects/{{projectId}}/docs

### Update Doc
PUT {{baseUrl}}/api/projects/{{projectId}}/docs/{{docId}}
Content-Type: application/json

{
  "title": "System Architecture v2",
  "docType": "design",
  "content": "Updated architecture: Added Cloudflare Queues for async processing and Workers AI for embeddings.",
  "status": "active"
}

###############################################
# ISSUE ENDPOINTS
###############################################

### Create Issue
# @name createIssue
POST {{baseUrl}}/api/projects/{{projectId}}/issues
Content-Type: application/json

{
  "title": "Implement authentication middleware",
  "description": "Add Better Auth session validation middleware to protect API routes. Should validate session token from Authorization header and set userId in context.",
  "priority": "high"
}

### Get Issue by ID (with description)
GET {{baseUrl}}/api/projects/{{projectId}}/issues/{{issueId}}

### List All Issues in Project
GET {{baseUrl}}/api/projects/{{projectId}}/issues

### Update Issue
PUT {{baseUrl}}/api/projects/{{projectId}}/issues/{{issueId}}
Content-Type: application/json

{
  "title": "Implement authentication middleware",
  "description": "Add Better Auth session validation middleware to protect API routes. Should validate session token from Authorization header and set userId in context. UPDATED: Will be done in Phase 3.",
  "status": "in_progress",
  "priority": "medium"
}

###############################################
# ERROR CASE TESTS
###############################################

### Test 404 - Non-existent Project
GET {{baseUrl}}/api/projects/00000000-0000-0000-0000-000000000000

### Test 400 - Invalid Doc Type
POST {{baseUrl}}/api/projects/{{projectId}}/docs
Content-Type: application/json

{
  "title": "Test",
  "docType": "invalid-type",
  "content": "This should fail"
}

### Test 400 - Missing Required Field
POST {{baseUrl}}/api/projects
Content-Type: application/json

{
  "description": "No name field"
}

### Test 404 - Doc for Wrong Project
GET {{baseUrl}}/api/projects/00000000-0000-0000-0000-000000000000/docs/{{docId}}

### Test 404 - Non-existent Issue
GET {{baseUrl}}/api/projects/{{projectId}}/issues/00000000-0000-0000-0000-000000000000

###############################################
# LEGACY TEST ROUTES (for debugging)
###############################################

### Test R2 Write
POST {{baseUrl}}/test/r2/write
Content-Type: application/json

{
  "key": "test/hello.json",
  "content": {
    "msg": "hello from R2",
    "timestamp": "2025-12-04"
  }
}

### Test R2 Read
GET {{baseUrl}}/test/r2/read/test/hello.json

### Test DB: Create Project (legacy)
POST {{baseUrl}}/test/db/project
Content-Type: application/json

{
  "name": "Test Project Legacy",
  "ownerId": "8DmS1YCNa4rpnPFoU521iAxzlt7I4iZe",
  "description": "Legacy test endpoint"
}

### Test DB: Create Doc (legacy)
POST {{baseUrl}}/test/db/doc
Content-Type: application/json

{
  "projectId": "{{projectId}}",
  "title": "Legacy Doc",
  "docType": "note",
  "content": "Testing legacy endpoint"
}

### Test DB: Get Doc (legacy)
GET {{baseUrl}}/test/db/doc/{{projectId}}/{{docId}}

###############################################
# RAG SEARCH ENDPOINTS (Phase 4)
###############################################

### RAG: Pure Vector Search (semantic)
# @name ragVectorSearch
POST {{baseUrl}}/api/rag/query
Content-Type: application/json

{
  "projectId": "{{projectId}}",
  "query": "How do I create a new branch in Git?",
  "config": {
    "hybridWeight": 1,
    "limit": 10
  }
}

### RAG: Pure Keyword Search
# @name ragKeywordSearch
POST {{baseUrl}}/api/rag/query
Content-Type: application/json

{
  "projectId": "{{projectId}}",
  "query": "What are the ethical implications of AI systems",
  "config": {
    "hybridWeight": 0,
    "limit": 5
  }
}

### RAG: Hybrid Search (balanced)
# @name ragHybridSearch
POST {{baseUrl}}/api/rag/query
Content-Type: application/json

{
  "projectId": "{{projectId}}",
  "query": "What are the ethical implications of AI systems",
  "config": {
    "hybridWeight": 0.5,
    "limit": 5,
    "topK": 20
  }
}

### RAG: Search with Filters
# @name ragSearchFilters
POST {{baseUrl}}/api/rag/query
Content-Type: application/json

{
  "projectId": "{{projectId}}",
  "query": "architecture",
  "filters": {
    "docTypes": ["design"],
    "statuses": ["active"]
  },
  "config": {
    "hybridWeight": 0.5,
    "limit": 5
  }
}

### RAG: Search with Pagination
# @name ragSearchPagination
POST {{baseUrl}}/api/rag/query
Content-Type: application/json

{
  "projectId": "{{projectId}}",
  "query": "cloudflare",
  "config": {
    "hybridWeight": 0.5,
    "limit": 2,
    "offset": 2
  }
}

### RAG: Get Analytics
# @name ragAnalytics
GET {{baseUrl}}/api/rag/analytics/{{projectId}}

###############################################
# HEALTH CHECK
###############################################

### Health Check
GET {{baseUrl}}/

